--- ->  ESSE SCRIPT É BASEADO COM SEGURANÇA DE BANCO DE DADOS, POIS ATRAVÉS DELE PODE FAZER OS COMANDO DML COM SEGURANÇA CONTANDO QUANTAS LINHAS FORAM ALTERADAS VISTO
--- -> QUE O IF DEVERÁ SER DEFINIDO A QUANTIDADE DE LINHAS ALTERADAS, CASO DER ERRO VOLTARA AO ROLLBACK E NÃO IRÁ EXECUTAR O COMANDO

USE DBMedico;

DECLARE 
    @TOTAL_LINHAS INT;
    Set @TOTAL_LINHAS = 0;


    BEGIN
    BEGIN TRAN

	INSERT INTO PACIENTES (NOME_PACIENTE, RG_PAC, CPF_PAC, END_PAC, CEP_PAC, BAIRRO_PAC, ID_ESTADO_CIVIL_PAC, ID_ESTADO_PAC, SINTOMAS, ID_MEDICO, INSERT_DATETIME, UPDATE_DATETIME, CIDADE_PAC)
             values ('Maria do carmo', '14523252-9', '85885567077', 'Av Pedro de Valdivia, nº 41, apto 25', '01542-885', 'Ilha do Retiro', '4', '16', 'Gripe e resfriado', '2', GETDATE(), null, 'Recife')
	SET @TOTAL_LINHAS = @@ROWCOUNT

PRINT 'Linhas Afetadas ' + CONVERT(VARCHAR, @TOTAL_LINHAS)

    BEGIN TRY
        IF @TOTAL_LINHAS = 1
        BEGIN
            COMMIT
            PRINT 'COMANDOS COMMITADOS'
        END
        ELSE
        BEGIN
            ROLLBACK
            PRINT 'ROLLBACK EFETUADO'
        END

    END TRY

    BEGIN CATCH
        PRINT 'ERRO: ' + ERROR_MESSAGE()
        ROLLBACK
        GOTO FIM
    END CATCH

FIM:
    PRINT 'QUERY FINALIZADA'

  END
  
  -----------------------------------------------------
  
---------- CONSULTADO OS DADOS INSERIDOS PELO SCRIPT

SELECT * FROM PACIENTES WHERE CPF_PAC = '85885567077';


------ CONFORME A TRIGGER DISPARADA O DADO FOI INSERIDO AUTOMATICAMENTE NA TABELA PACIENTE_ALTA

SELECT * FROM PACIENTE_ALTA WHERE ID_PACIENTE = '23';

